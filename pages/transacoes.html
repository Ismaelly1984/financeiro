<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>MeuFinanceiro | Transações — Controle Financeiro Pessoal</title>
  <meta name="description" content="Registre, edite e acompanhe seu histórico de transações. MeuFinanceiro PWA facilita controle de receitas, despesas, exportação CSV e organização de gastos.">
  <meta name="keywords" content="transações, controle financeiro, gastos, receitas, histórico, exportar CSV, app PWA, orçamentos, despesas pessoais">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#3b82f6">
  <link rel="canonical" href="https://ismaelly1984.github.io/financeiro/transacoes.html">

  <!-- CSS -->
  <link rel="stylesheet" href="../assets/css/style.css" />

  <!-- PWA -->
  <link rel="manifest" href="../manifest.json" />
  <link rel="icon" type="image/png" href="../favicon.png" />

  <!-- Libs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ismaelly1984.github.io/financeiro/transacoes.html">
  <meta property="og:title" content="MeuFinanceiro | Transações — Controle Financeiro Pessoal">
  <meta property="og:description" content="Registre, edite e acompanhe seu histórico de transações. MeuFinanceiro PWA facilita controle de receitas, despesas, exportação CSV e organização de gastos.">
  <meta property="og:image" content="https://ismaelly1984.github.io/financeiro/assets/screenshots/resumo.png">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="MeuFinanceiro | Transações — Controle Financeiro Pessoal">
  <meta name="twitter:description" content="Registre, edite e acompanhe seu histórico de transações. MeuFinanceiro PWA facilita controle de receitas, despesas, exportação CSV e organização de gastos.">
  <meta name="twitter:image" content="https://ismaelly1984.github.io/financeiro/assets/screenshots/resumo.png">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar" role="navigation" aria-label="Navegação principal">
  <div class="navbar-container">
    <a class="nav-back" href="../index.html" aria-label="Voltar"><i class="fas fa-arrow-left"></i> Voltar</a>
    <h1 class="logo">MeuFinanceiro</h1>
    <button class="hamburger" id="hamburger" aria-label="Abrir menu" aria-expanded="false">&#9776;</button>
    <ul class="nav-links" id="nav-links">
      <li><a href="/index.html">Resumo</a></li>
      <li><a href="/pages/transacoes.html">Transações</a></li>
      <li><a href="/pages/graficos.html">Gráficos</a></li>
      <li><a href="/pages/relatorios.html">Relatórios</a></li>
      <li><a href="/pages/help.html">Ajuda</a></li>
      <li>
        <button id="toggle-tema" class="btn-acoes" aria-label="Alternar tema claro/escuro">
          <i class="fas fa-moon"></i>
        </button>
      </li>
    </ul>
  </div>
</nav>

  <!-- Toasts -->
  <div id="mensagem-app" class="mensagem-app" role="status" aria-live="polite"></div>

  <main class="container">
    <h1><i class="fas fa-list"></i> Transações</h1>

    <!-- Novo bloco: Sobre -->
    <section class="sobre-transacoes">
      <h2>Gerencie suas transações</h2>
      <p>
        Nesta seção você pode registrar todas as suas <strong>despesas</strong> e <strong>receitas</strong>, 
        categorizando cada lançamento em alimentação, transporte, lazer, saúde, educação e muito mais. 
        O <em>MeuFinanceiro</em> organiza automaticamente seus dados, mantendo um histórico completo e atualizado.
      </p>
      <p>
        Também é possível editar, excluir e exportar suas movimentações em formato <strong>CSV</strong>, 
        facilitando a análise e integração com planilhas externas.
      </p>
    </section>

    <!-- Formulário -->
    <form id="form">
      <input type="text" id="descricao" name="descricao" placeholder="Descrição" required />
      <input type="number" id="valor" name="valor" placeholder="Valor (R$)" required step="0.01" />
      <select id="tipo" name="tipo" required>
        <option value="despesa">Despesa</option>
        <option value="receita">Receita</option>
      </select>
      <select id="categoria" name="categoria" required>
        <option value="alimentacao">🍽️ Alimentação</option>
        <option value="transporte">🚌 Transporte</option>
        <option value="lazer">🎮 Lazer</option>
        <option value="saude">🏥 Saúde</option>
        <option value="educacao">📚 Educação</option>
        <option value="salario">💰 Salário</option>
        <option value="outros">🧩 Outros</option>
      </select>
      <input type="date" id="data" name="data" required />
      <button type="submit" class="btn-acoes"><i class="fas fa-plus"></i> Adicionar</button>
    </form>

    <!-- Filtros / Ordenação / Export -->
    <section class="transacoes">
      <div class="filter-sort-controls">
        <div class="filter-controls">
          <select id="filtro-tipo" aria-label="Filtrar por tipo">
            <option value="todos">Todos os Tipos</option>
            <option value="receita">Receitas</option>
            <option value="despesa">Despesas</option>
          </select>
          <select id="filtro-categoria" aria-label="Filtrar por categoria">
            <option value="todas">Todas as Categorias</option>
            <option value="alimentacao">🍽️ Alimentação</option>
            <option value="transporte">🚌 Transporte</option>
            <option value="lazer">🎮 Lazer</option>
            <option value="saude">🏥 Saúde</option>
            <option value="educacao">📚 Educação</option>
            <option value="salario">💰 Salário</option>
            <option value="outros">🧩 Outros</option>
          </select>
        </div>
        <div class="sort-controls">
          <select id="ordenar-por" aria-label="Ordenar por">
            <option value="data">Data</option>
            <option value="valor">Valor</option>
            <option value="descricao">Descrição</option>
          </select>
          <button id="toggle-ordenacao" class="btn-acoes" aria-label="Alternar ordem">
            <i class="fas fa-sort-amount-down"></i>
          </button>
        </div>
        <button id="btn-exportar" class="btn-acoes">
          <i class="fas fa-file-csv"></i> Exportar CSV
        </button>
      </div>

      <div id="caixa-transacoes" class="caixa-transacoes" role="region" aria-label="Lista de transações rolável">
        <ul id="lista-transacoes" role="list" aria-live="polite"></ul>
        <div id="loading" class="loading" aria-hidden="true">
          <i class="fas fa-spinner fa-spin"></i> Carregando…
        </div>
      </div>
    </section>

    <!-- Novo bloco: Dicas -->
    <section class="dicas-transacoes">
      <h2>Dicas para organizar suas finanças</h2>
      <ul>
        <li>✅ Registre cada gasto logo após a compra para manter o histórico completo.</li>
        <li>✅ Categorize suas despesas para entender <strong>onde está gastando mais</strong>.</li>
        <li>✅ Use o filtro de transações para identificar padrões de consumo.</li>
        <li>✅ Aproveite a exportação CSV para criar relatórios personalizados.</li>
      </ul>
    </section>

    <!-- Limite geral -->
    <section id="limite-app" class="limite-gastos mt-2">
      <h2><i class="fas fa-bullseye"></i> Controle de Limite</h2>
      <label for="limite">Definir limite de gastos (R$):</label>
      <input type="number" id="limite" name="limite" placeholder="Ex: 1000" />
      <div class="progress-bar" role="progressbar" aria-label="Progresso do limite" aria-valuemin="0" aria-valuemax="100">
        <div id="barra-progresso" class="progress-bar-fill"></div>
      </div>
      <p><strong>Gasto até agora:</strong> R$ <span id="gasto-atual">0.00</span>
        (<span id="porcentagem-gasto">0</span>%)</p>
    </section>

    <!-- Orçamento por Categoria -->
    <section id="orcamento-categorias" class="orcamento-categorias mt-2">
      <h2><i class="fas fa-chart-pie"></i> Orçamento por Categoria</h2>
      <div class="orcamento-controles">
        <select id="select-categoria-orcamento" aria-label="Selecionar categoria para orçamento">
          <option value="">Selecionar Categoria</option>
          <option value="alimentacao">🍽️ Alimentação</option>
          <option value="transporte">🚌 Transporte</option>
          <option value="lazer">🎮 Lazer</option>
          <option value="saude">🏥 Saúde</option>
          <option value="educacao">📚 Educação</option>
          <option value="outros">🧩 Outros</option>
        </select>
        <input type="number" id="input-limite-categoria" placeholder="Definir Limite (R$)" step="0.01" />
        <button id="btn-salvar-limite-categoria" class="btn-acoes"><i class="fas fa-save"></i> Salvar Limite</button>
      </div>
      <div id="lista-orcamentos-categorias" class="lista-orcamentos-categorias"></div>
    </section>

    <!-- Novo bloco: FAQ -->
    <section class="faq-transacoes">
      <h2>Perguntas Frequentes</h2>
      <h3>Posso editar uma transação depois de salvar?</h3>
      <p>Sim. Basta clicar no ícone de edição e atualizar os dados desejados.</p>

      <h3>É possível exportar todas as movimentações?</h3>
      <p>Sim. Clique no botão <em>Exportar CSV</em> para baixar seu histórico completo de receitas e despesas.</p>

      <h3>Quantas transações posso salvar?</h3>
      <p>Não há limite prático. Todas ficam armazenadas localmente no seu navegador.</p>
    </section>
  </main>

  <!-- Modal de edição -->
  <div id="modal-editar" class="modal" aria-hidden="true" tabindex="-1" aria-labelledby="modal-editar-title">
    <div class="modal-content">
      <span id="modal-editar-close" class="close-btn" aria-label="Fechar modal">&times;</span>
      <h2 id="modal-editar-title">Editar Transação</h2>
      <form id="form-editar">
        <input type="hidden" id="edit-id" name="edit-id" />
        <input type="text" id="edit-descricao" name="edit-descricao" placeholder="Descrição" required />
        <input type="number" id="edit-valor" name="edit-valor" placeholder="Valor (R$)" required step="0.01" />
        <select id="edit-tipo" name="edit-tipo" required>
          <option value="despesa">Despesa</option>
          <option value="receita">Receita</option>
        </select>
        <select id="edit-categoria" name="edit-categoria" required>
          <option value="alimentacao">🍽️ Alimentação</option>
          <option value="transporte">🚌 Transporte</option>
          <option value="lazer">🎮 Lazer</option>
          <option value="saude">🏥 Saúde</option>
          <option value="educacao">📚 Educação</option>
          <option value="salario">💰 Salário</option>
          <option value="outros">🧩 Outros</option>
        </select>
        <input type="date" id="edit-data" name="edit-data" required />
        <div class="modal-buttons">
          <button type="submit" class="modal-salvar-btn btn-acoes"><i class="fas fa-save"></i> Salvar</button>
          <button type="button" id="editar-cancelar-btn" class="modal-cancelar-btn btn-acoes">
             <i class="fas fa-times"></i> Cancelar
           </button>
         </div>
      </form>
    </div>
  </div>

  <!-- Modal de confirmação -->
  <div id="modal-confirmacao" class="modal" aria-hidden="true" tabindex="-1" aria-labelledby="modal-confirmacao-title">
    <div class="modal-content">
      <h2 id="modal-confirmacao-title">Confirmar Exclusão</h2>
      <p>Tem certeza que deseja excluir esta transação?</p>
      <div class="modal-buttons">
        <button id="confirmar-exclusao-btn" class="modal-salvar-btn btn-acoes">Sim</button>
        <button id="cancelar-exclusao-btn" class="modal-cancelar-btn btn-acoes">Não</button>
      </div>
    </div>
  </div>

  <!-- Rodapé -->
  <footer class="footer">
  <div class="footer-container">
    <p>&copy; 2025 MeuFinanceiro. Todos os direitos reservados.</p>
    <div class="footer-links">
      <a href="/index.html" title="Resumo" aria-label="Ir para Resumo" data-tooltip="Resumo"><i class="fas fa-chart-pie"></i></a>
      <a href="/pages/transacoes.html" title="Transações" aria-label="Ir para Transações" data-tooltip="Transações"><i class="fas fa-list"></i></a>
      <a href="/pages/graficos.html" title="Gráficos" aria-label="Ir para Gráficos" data-tooltip="Gráficos"><i class="fas fa-chart-line"></i></a>
      <a href="/index.html#limite-app" title="Limite" aria-label="Ir para Limite" data-tooltip="Limite"><i class="fas fa-bullseye"></i></a>
      <a href="/index.html#orcamento-categorias" title="Orçamento" aria-label="Ir para Orçamento" data-tooltip="Orçamento"><i class="fas fa-money-check-alt"></i></a>
    </div>
  </div>
</footer>

  <!-- FAB Ajuda -->
  <a href="./help.html" id="btn-ajuda-flutuante" class="fab-ajuda" aria-label="Abrir ajuda">
    <i class="fas fa-question"></i>
  </a>

  <!-- App -->
  <script type="module" src="../js/app.js"></script>
  <script>
    (function hamburgerToggle() {
      const btn = document.getElementById('hamburger');
      if (!btn) return;

      function setExpanded(value) {
        btn.setAttribute('aria-expanded', value ? 'true' : 'false');
        document.documentElement.classList.toggle('menu-open', value);
      }

      btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        setExpanded(!expanded);
      });

      // Fecha o menu ao pressionar Esc
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && btn.getAttribute('aria-expanded') === 'true') {
          setExpanded(false);
        }
      });

      // Em telas largas garante que o estado não fique aberto por engano
      window.addEventListener('resize', () => {
        if (window.innerWidth > 900) setExpanded(false);
      });
    })();

    // IIFE: focus trap para modais (editar / confirmação)
    (function modalFocusTrap() {
      const modalEditar = document.getElementById('modal-editar');
      const modalConfirm = document.getElementById('modal-confirmacao');
      const modals = [modalEditar, modalConfirm].filter(Boolean);
      if (!modals.length) return;

      function getFocusable(container) {
        return Array.from(container.querySelectorAll(
          'a[href], area[href], input:not([disabled]):not([type=hidden]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex]:not([tabindex="-1"])'
        )).filter(el => el.offsetWidth || el.offsetHeight || el.getClientRects().length);
      }

      const state = new Map(); // stores handlers and previous focus

      function isVisible(el) {
        if (!el) return false;
        const style = window.getComputedStyle(el);
        return style.display !== 'none' && style.visibility !== 'hidden' && parseFloat(style.opacity) !== 0 && el.offsetParent !== null;
      }

      function activate(modal) {
        if (state.get(modal)) return; // already active
        // set dialog semantics
        modal.setAttribute('role', 'dialog');
        modal.setAttribute('aria-modal', 'true');
        modal.removeAttribute('aria-hidden');

        const prev = document.activeElement;
        state.set(modal, { prev });

        const focusables = getFocusable(modal);
        const first = focusables[0] || modal;
        const last = focusables[focusables.length - 1] || modal;

        function onKey(e) {
          if (e.key === 'Escape') {
            e.preventDefault();
            closeModal(modal);
            return;
          }
          if (e.key === 'Tab') {
            if (focusables.length === 0) {
              e.preventDefault();
              return;
            }
            if (e.shiftKey) {
              if (document.activeElement === first || modal === document.activeElement) {
                e.preventDefault();
                last.focus();
              }
            } else {
              if (document.activeElement === last) {
                e.preventDefault();
                first.focus();
              }
            }
          }
        }

        function onFocusIn(e) {
          if (!modal.contains(e.target)) {
            // Keep focus inside
            (first || modal).focus();
          }
        }

        document.addEventListener('keydown', onKey, true);
        document.addEventListener('focusin', onFocusIn, true);

        state.get(modal).onKey = onKey;
        state.get(modal).onFocusIn = onFocusIn;

        // Prevent background scrolling while modal open
        document.body.style.overflow = 'hidden';

        // Focus the first focusable element
        (first || modal).focus();
      }

      function closeModal(modal) {
        const entry = state.get(modal);
        if (!entry) return;
        const { onKey, onFocusIn, prev } = entry;
        if (onKey) document.removeEventListener('keydown', onKey, true);
        if (onFocusIn) document.removeEventListener('focusin', onFocusIn, true);

        // Restore scrolling
        document.body.style.overflow = '';

        // Restore focus
        try { prev?.focus(); } catch (err) { /* ignore */ }

        // mark closed for a11y
        modal.setAttribute('aria-hidden', 'true');

        state.delete(modal);
      }

      // Wire up close buttons inside modals
      const mappings = [
        { modalId: 'modal-editar', closeIds: ['modal-editar-close', 'editar-cancelar-btn'] },
        { modalId: 'modal-confirmacao', closeIds: ['confirmar-exclusao-btn', 'cancelar-exclusao-btn'] }
      ];
      mappings.forEach(m => {
        const modalEl = document.getElementById(m.modalId);
        if (!modalEl) return;
        m.closeIds.forEach(id => {
          const el = document.getElementById(id);
          if (!el) return;
          el.addEventListener('click', () => closeModal(modalEl));
        });
      });

      // Observe attribute/style changes to detect when modals become visible
      const observer = new MutationObserver(() => {
        modals.forEach(modal => {
          if (isVisible(modal)) {
            if (!state.get(modal)) activate(modal);
          } else {
            if (state.get(modal)) closeModal(modal);
          }
        });
      });
      modals.forEach(m => observer.observe(m, { attributes: true, attributeFilter: ['style', 'class', 'aria-hidden'] }));

      // Fallback: initial check
      modals.forEach(m => {
        if (isVisible(m)) activate(m);
        else m.setAttribute && m.setAttribute('aria-hidden', 'true');
      });

    })();
  </script>
</body>
</html>
